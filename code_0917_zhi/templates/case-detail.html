<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>å€‹æ¡ˆè©³ç´°è³‡æ–™</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/case-detail.css') }}"
    />
  </head>
  <body>
    <div class="detail-container">
      <h2>å€‹æ¡ˆè©³ç´°è³‡æ–™</h2>

      <!-- åŸºæœ¬è³‡æ–™ -->
      <div class="detail-header">
        <div class="detail-info">
          <!-- ç¬¬ä¸€è¡Œ -->
          <div class="info-row">
            <div class="info-cell">ç—…æ­·è™Ÿï¼š{{ case.medical_record_no }}</div>
            <div class="info-cell">å§“åï¼š{{ case.patient_name }}</div>
            <div class="info-cell">
              æ€§åˆ¥ï¼š {% if case.gender == "1" %} ç”· {% elif case.gender == "2"
              %} å¥³ {% else %} - {% endif %}
            </div>
          </div>

          <!-- ç¬¬äºŒè¡Œ -->
          <div class="info-row">
            <div class="info-cell">å‡ºç”Ÿæ—¥æœŸï¼š{{ case.birth_date }}</div>
            <div class="info-cell">èº«åˆ†è­‰è™Ÿï¼š{{ case.id_document_no }}</div>
            <div class="info-cell select-wrapper">
              <label for="visitDateSelect">é¸æ“‡æ”¶æ¡ˆæ—¥æœŸï¼š</label>
              <select
                id="visitDateSelect"
                onchange="updateProgressView()"
                {%
                if
                not
                case.visit_dates
                %}disabled{%
                endif
                %}
              >
                {% if case.visit_dates %} {% for date in case.visit_dates %}
                <option
                  value="{{ date }}"
                  {%
                  if
                  loop.last
                  %}selected{%
                  endif
                  %}
                >
                  {{ date.replace('-', '/') }}
                </option>
                {% endfor %} {% else %}
                <option>ç„¡å¯ç”¨æ—¥æœŸ</option>
                {% endif %}
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- å¿«é€Ÿæ–°å¢åŠŸèƒ½æŒ‰éˆ•å€å¡Š -->
      <div class="quick-actions">
        <a href="/phone-followups/{{ case.medical_record_no }}">
          <button class="quick-btn">ğŸ“ é›»è¨ªç´€éŒ„</button>
        </a>
        <a href="/add-service-record/{{ case.medical_record_no }}">
          <button class="quick-btn">ğŸ“‹ å€‹æ¡ˆæœå‹™ç´€éŒ„</button>
        </a>

        <a href="/adl-iadl-form/{{ case.medical_record_no }}">
          <button class="quick-btn">ğŸ§® ADL/IADLé‡è¡¨</button>
        </a>
        <a href="/return-to-work-form/{{ case.medical_record_no }}">
          <button class="quick-btn">â›‘ï¸ å¾©å·¥ç´€éŒ„</button>
        </a>
      </div>

      <!-- æ¨¡çµ„é€²åº¦ï¼ˆ2æ¬„ï¼‰ -->
      <div class="module-grid">
        {% for module in [ ('å€‹æ¡ˆè¨ªè«‡', 'interview_progress', '/interview/' ~
        case.medical_record_no, 'ğŸ“'), ('é›»è©±é—œæ‡·', 'call_progress',
        '/phone-care/' ~ case.medical_record_no, 'ğŸ“'), ('æœå‹™ç´€éŒ„',
        'service_progress', '/service-record/' ~ case.medical_record_no, 'ğŸ“‹'),
        ('å¾©å·¥è¿½è¹¤', 'return_progress', '/return-to-work/' ~
        case.medical_record_no, 'â›‘ï¸') ] %}
        <div class="section" title="{{ module[0] }}é€²åº¦èªªæ˜">
          <h3><span class="icon">{{ module[3] }}</span> {{ module[0] }}é€²åº¦</h3>
          <div class="progress-bar progress-{{ module[1] }}">
            <div class="progress" data-progress="{{ case[module[1]] }}">0%</div>
          </div>
          <a href="{{ module[2] }}">
            <button class="action-btn">é€²å…¥{{ module[0] }}</button>
          </a>
        </div>
        {% endfor %}
      </div>

      <a href="/case-query" class="back-btn">è¿”å›æŸ¥è©¢</a>
    </div>

    <!-- é€²åº¦æ¢å‹•ç•« -->
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".progress").forEach((el) => {
          const target = parseInt(el.dataset.progress);
          let current = 0;
          const step = Math.ceil(target / 20);
          const speed = 15;

          const interval = setInterval(() => {
            current += step;
            if (current >= target) {
              current = target;
              clearInterval(interval);
            }
            el.textContent = current + "%";
            el.style.width = current + "%";
          }, speed);
        });
      });
    </script>
  </body>
</html>
